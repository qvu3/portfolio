---
title: "FitBit_data_analysis_case_study"
author: "Vu, Quang Hoai Son"
date: "`r Sys.Date()`"
output: html_document
---

## 1. Business Task

Analyze smart device usage data in order to gain insight into how consumers use non-Bellabeat smart
devices. Then, select one Bellabeat product to apply these insights to in the presentation.

## 2. Data sources used 
https://zenodo.org/record/53894#.X9oeh3Uzaao
These dataset were generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016.  Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B).  Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences. 

## 3. Data Cleaning

### Import necessary packages
```{r results="hide"}
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(janitor) 
library(skimr) 
library(stringi)
library(lubridate)
```

### Import data
```{r results="hide"}
setwd("/Users/Astorrevu/Desktop/Data Analytics Cases/data")
sleepDay_df <- read_csv("sleepDay_merged.csv")
minuteMETsNarrow_df <- read_csv("minuteMETsNarrow_merged.csv")
minuteIntensitiesNarrow_df <- read_csv("minuteIntensitiesNarrow_merged.csv")
dailyActivity_df <- read_csv("dailyActivity_merged.csv")
```

### Create a dataframes names combination to speed up data cleaning
```{r results="hide"}
df_names <- c('sleepDay_df', 'minuteMETsNarrow_df', 'minuteIntensitiesNarrow_df', 'dailyActivity_df')
```

### Clean names, remove empty rows and columns, remove duplicates for all data frames using 'for loop'
```{r results="hide"}
for (i in df_names) {
  assign(i, janitor::clean_names(get(i)))
  assign(i, janitor::remove_empty(get(i), which = c('rows','cols'), quiet = FALSE))
  assign(i, dplyr::distinct(get(i)))
}
```

By using the n_distinct function, it shows most of the data frames have 33 participants (less than 50), some of them even have less, indicates that the data set is not big enough for a reliable data analysis. In this case, a data analysis is still performed for demonstration only.
```{r}
for (i in df_names){
  print(n_distinct(get(i)$id))
}
```

## 4. Data Analysis

### 4.1. What data are we looking at?

The first plot below shows that most of the recorded MET scores are around 8 and some above 8, which indicates the exercises (that people in the data set do) have moderate to high intensity.
```{r}
ggplot(data = minuteMETsNarrow_df)+
  geom_bar(mapping = aes(x = me_ts))
```

The second plot below shows that the intensity 0 has the highest count, then 1. This means people in the data set spend most time doing low intensity activities such as sitting still or slow walking (sedentary).
```{r}
ggplot(data = minuteIntensitiesNarrow_df)+
  geom_bar(mapping = aes(x = intensity))
```

The last plot below shows that people usually have high intensity activities at around 12-1PM and 5-6PM. This could be people that start their working day very early in the morning, and those who regularly work in their offices (sedentary) that clock out at around 5-6PM and workout after that.
```{r}
minuteIntensitiesNarrow_df$activity_minute <- mdy_hms(minuteIntensitiesNarrow_df$activity_minute)
```

```{r}
ggplot(data = minuteIntensitiesNarrow_df)+
  geom_bar(mapping = aes(x = hour(activity_minute), y = intensity), stat = "identity")
```

**First Conclusion**: The data we are looking at shows a sample of sedentary people, who usually have low intensity activities during their days, but do spend some times to do moderate to high intensity exercises after their regular working hours.

### 4.2 What does the data tell us?

We start with the plot below, that shows the more a person stays in bed, the longer they are asleep, which is quite obvious. 
```{r}
ggplot(data = sleepDay_df)+
  geom_point(mapping = aes(x=total_minutes_asleep, y=total_time_in_bed))
```

While staying in bed make one sleep more, let see if doing more exercises help them sleep as well or not. Therefore, we need to merge data relative to both sleeping and activity.

To prepare, lets fix the date and time format of the data using lubridate package
```{r results="hide"}
sleepDay_df$sleep_day <- mdy_hms(sleepDay_df$sleep_day)
dailyActivity_df$activity_date <- mdy(dailyActivity_df$activity_date)
```

Then merge the daily sleep and activity data by "id" and "activity_date"/"sleep_day"
```{r results="hide"}
daily_sl_ac <- merge(dailyActivity_df, sleepDay_df, by.x = c("id","activity_date"), by.y = c("id","sleep_day"))
```

After that, we use the merged data to make the plot below to see if total_calories burned lead to longer sleeps? The answer is 'No'! 
```{r}
ggplot(data = daily_sl_ac)+
  geom_point(mapping = aes(x = calories, y = total_minutes_asleep))
```

On the other hand, the plot below shows that the more time people spend sedentary, the less they are asleep. The less people sleep, the more they can gain risks of their health.
```{r}
ggplot(data = daily_sl_ac)+
  geom_point(mapping = aes(x = sedentary_minutes, y = total_minutes_asleep))
```

**Second Conclusion**: There is an indication that more active people can sleep more and may be healthier than sedentary people.

## 5. Summary:
To summarize, the data set shows that people mostly spend their time doing low intensity activities during the day. It also tells us that the more time people do so (sedentary), the less they sleep, and that may put their health at more risks. Therefore, by staying more active through the day, people can sleep better and stay healthier.

## 6.Recommendations:
To help people stay more active during their days, smart products could be programmed to automatically and regularly remind people to do the following:
  +  more moderately intense activities right around their workplaces beside of their daily exercises at the gyms
  + drink more water to stay hydrating
  + get in bed early before the desired sleep time to wind down and get to sleep better
These reminders can help people to stay more active and healthier.
